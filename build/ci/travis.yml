dist: bionic
language: go
go:
  - "1.15.x"

sudo: false

services:
  - docker

# we don't run anything on main branch
if: branch != main

jobs:
  include:
    - stage: test
      before_install:
        - make bootstrap
      before_script:
        - make lint
        - make vet
        - make check-spelling
      script:
        - make test
    - stage: build local
      script:
        - make
    - stage: build all-platforms
      script:
      - make all-platforms


#deploy:
#  provider: releases
#  api_key: "GITHUB OAUTH TOKEN"
#  file_glob: true
#  file: release/*
#  skip_cleanup: true
#  on:
#    tags: true